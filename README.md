# Flutter SNS App Specification

## Supabaseの作成SQL

```sql
-- posts table
CREATE TABLE posts (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  content TEXT NOT NULL CHECK (char_length(content) <= 512),
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  like_count INT DEFAULT 0 NOT NULL
);

-- comments table
CREATE TABLE comments (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  post_id BIGINT REFERENCES posts(id) ON DELETE CASCADE NOT NULL,
  content TEXT NOT NULL CHECK (char_length(content) <= 512),
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);

-- likes table
CREATE TABLE likes (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  post_id BIGINT REFERENCES posts(id) ON DELETE CASCADE NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  UNIQUE(post_id)
);

-- function to increment like count
CREATE OR REPLACE FUNCTION increment_like_count(post_id_param BIGINT)
RETURNS void AS $$
BEGIN
  UPDATE posts
  SET like_count = like_count + 1
  WHERE id = post_id_param;
END;
$$ LANGUAGE plpgsql;

-- function to decrement like count
CREATE OR REPLACE FUNCTION decrement_like_count(post_id_param BIGINT)
RETURNS void AS $$
BEGIN
  UPDATE posts
  SET like_count = like_count - 1
  WHERE id = post_id_param;
END;
$$ LANGUAGE plpgsql;
```

## 設計理由

- **フレームワーク**: Flutterを採用しました。単一のコードベースでウェブ、iOS、Androidなど、複数のプラットフォームに対応できるため、開発効率が高いと判断しました。
- **データベース**: Supabase (PostgreSQL) を選択しました。リアルタイム機能、認証、ストレージなど、多くのバックエンド機能が統合されており、迅速な開発が可能です。また、PostgreSQLの強力な機能を活用できる点も魅力です。
- **アーキテクチャ**: UIとロジックを分離するため、`StatefulWidget`内で状態管理を行いました。小規模なアプリケーションであるため、この構成で十分だと判断しました。
- **UI/UX**: シンプルで直感的なUIを目指しました。投稿、編集、削除、いいねの各機能は、ユーザーが迷わず操作できるよう、明確なアイコンとボタンで配置しました。日本語の文言を採用し、日本のユーザーにとって親しみやすい体験を提供します。

## 必要パッケージ一覧

- `supabase_flutter`: Supabaseとの連携に必要です。
- `flutter_dotenv`: 環境変数を管理するために使用します。APIキーなどの機密情報を安全に扱います。
- `intl`: 日付や時刻のフォーマットに使用します。

## Supabase接続設定手順

1.  **Supabaseプロジェクトの作成**: [Supabase公式サイト](https://supabase.com/)で新しいプロジェクトを作成します。
2.  **SQLの実行**: SupabaseプロジェクトのSQL Editorで、上記の「Supabaseの作成SQL」を実行し、テーブルと関数を作成します。
3.  **APIキーの取得**: プロジェクト設定の「API」セクションから、`URL`と`anon key`を取得します。
4.  **.env.exampleファイルの編集**: プロジェクトのルートディレクトリにある`.env.example`ファイルをコピーして`.env`ファイルを作成し、以下の内容を記述します。

5.  **pubspec.yamlの編集**: `pubspec.yaml`ファイルに`.env`ファイルをアセットとして追加します。

    ```yaml
    flutter:
      assets:
        - .env
    ```

## Flutter Webとしてビルドを行い、Vercelにデプロイする手順

1.  **Flutter Webの有効化**: ターミナルで以下のコマンドを実行し、Flutter Webを有効化します。

    ```bash
    flutter config --enable-web
    ```

2.  **プロジェクトのビルド**: 以下のコマンドで、Web用のアプリケーションをビルドします。

    ```bash
    flutter build web
    ```

3.  **Vercelアカウントの作成**: [Vercel公式サイト](https://vercel.com/)でアカウントを作成します。
4.  **Vercel CLIのインストール**: ターミナルで以下のコマンドを実行し、Vercel CLIをインストールします。

    ```bash
    npm install -g vercel
    ```

5.  **デプロイ**: プロジェクトのルートディレクトリで、以下のコマンドを実行してデプロイします。

    ```bash
    vercel
    ```

    デプロイ中に表示される質問には、以下のように回答します。

    -   `Set up and deploy “/path/to/your/project”?` -> `y`
    -   `Which scope do you want to deploy to?` -> 自分のVercelアカウントを選択
    -   `Link to existing project?` -> `n`
    -   `What’s your project’s name?` -> （任意のプロジェクト名）
    -   `In which directory is your code located?` -> `./build/web`

    デプロイが完了すると、アプリケーションのURLが表示されます。
